import{XtalFetchReq,snakeToCamel}from"./xtal-fetch-req.js";const forEach="for-each",setPath="set-path";class XtalFetchEntities extends XtalFetchReq{static get is(){return"xtal-fetch-entities"}get forEach(){return this._forEach||this.getAttribute("for-each")}set forEach(a){this.setAttribute("for-each",a)}get setPath(){return this._setPath||this.getAttribute(setPath)}set setPath(a){this.setAttribute(setPath,a)}get inEntities(){return this._inEntities}set inEntities(a){this._inEntities=a,this.onPropsChange()}static get observedAttributes(){return super.observedAttributes.concat(["for-each",setPath])}attributeChangedCallback(a,b,c){a===setPath||"for-each"===a?this["_"+snakeToCamel(a)]=c:void 0;super.attributeChangedCallback(a,b,c)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(["forEach","setPath","inEntities"])}onPropsChange(){const a=this.setPath||this.forEach||this.inEntities;a&&(this._hasAllThreeProps=this._setPath&&this._forEach&&this.inEntities,!this._hasAllThreeProps)||super.onPropsChange()}do(){if(!this._hasAllThreeProps)return void super.do();const a=this._forEach.split(",");let b=this._inEntities.length;this.fetchInProgress=!0;let c=0;const d=this._baseLinkId?self[this._baseLinkId].href:"";for(let e=0,f=this._inEntities.length;e<f;e++){const f=this._inEntities[e];f.__xtal_idx=c,c++;let g=this._href;if(a.forEach(a=>{g=g.replace(":"+a,f[a])}),g=d+g,this._cacheResults){const a=this.cachedResults[g];if(a)return f[this._setPath]=a,b--,void(0===b&&(this.fetchInProgress=!1))}self.fetch(g,this._reqInit).then(a=>{200===a.status?a[this._as]().then(a=>{b--,0===b&&(this.fetchInProgress=!1),this._cacheResults&&(this.cachedResults[g]=a),f[this._setPath]=a;const c={entity:f,href:g};this.dispatchEvent(new CustomEvent("fetch-complete",{detail:c,bubbles:!0,composed:!1}))}):(a.text().then(a=>{this.errorText=a}),this.errorResponse=a)})}}}customElements.get(XtalFetchEntities.is)||customElements.define(XtalFetchEntities.is,XtalFetchEntities);class XtalFetch extends XtalFetchEntities{static get is(){return"xtal-fetch"}}customElements.get(XtalFetch.is)||customElements.define(XtalFetch.is,XtalFetch);
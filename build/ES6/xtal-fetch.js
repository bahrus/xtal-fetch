(function(){function a(a){return a.replace(/(\-\w)/g,function(a){return a[1].toUpperCase()})}const b="href",c="disabled";class d extends HTMLElement{constructor(){super(...arguments),this._reqInit={credentials:"include"},this._as="json"}static get is(){return"xtal-fetch-get"}de(a,b){const c=new CustomEvent(a+"-changed",{detail:b,bubbles:!0,composed:!1});return this.dispatchEvent(c),c}get fetch(){return this._fetch}set fetch(a){a?this.setAttribute("fetch",""):this.removeAttribute("fetch")}get disabled(){return this.hasAttribute(c)}set disabled(a){a?this.setAttribute(c,""):this.removeAttribute(c)}get href(){return this._href}set href(a){this.setAttribute(b,a)}get result(){return this._result}set result(a){this._result=a,this.de("result",a)}static get observedAttributes(){return["fetch",b,c]}_upgradeProperties(a){a.forEach(a=>{if(this.hasOwnProperty(a)){let b=this[a];delete this[a],this[a]=b}})}attributeChangedCallback(a,b,d){this["_"+a]="fetch"===a||a===c?null!==d:d;this.onPropsChange()}onPropsChange(){this.loadNewUrl()}loadNewUrl(){this.fetch&&this.href&&!this.disabled&&this.do()}do(){self.fetch(this.href,this._reqInit).then(a=>{a[this._as]().then(a=>{this.result=a})})}connectedCallback(){this._upgradeProperties(["fetch",b,c])}}customElements.get(d.is)||customElements.define(d.is,d);const e="req-init-required",f="cache-results",g="insert-results",h="base-link-id";class i extends d{constructor(){super(),this._cacheResults=!1,this._cachedResults={},this._fetchInProgress=!1,this._reqInit=null}get reqInit(){return this._reqInit}set reqInit(a){this._reqInit=a,this.onPropsChange()}onPropsChange(){this.reqInitRequired&&!this.reqInit||(!this.__loadNewUrlDebouncer&&this.debounceDurationHandler(),this.__loadNewUrlDebouncer())}static get is(){return"xtal-fetch-req"}get cacheResults(){return this._cacheResults}set cacheResults(a){a?this.setAttribute(f,""):this.removeAttribute(f)}get cachedResults(){return this._cachedResults}get reqInitRequired(){return this.hasAttribute(e)}set reqInitRequired(a){a?this.setAttribute(e,""):this.removeAttribute(e)}get debounceDuration(){return this._debounceDuration}set debounceDuration(a){this.setAttribute("debounce-duration",a.toString())}get errorResponse(){return this._errorResponse}set errorResponse(a){this._errorResponse=a,this.de("error-response",{value:a})}get errorText(){return this._errorText}set errorText(a){this._errorText=a,this.de("error-text",{value:a})}get fetchInProgress(){return this._fetchInProgress}set fetchInProgress(a){this._fetchInProgress=a,this.de("fetch-in-progress",{value:a})}get insertResults(){return this._insertResults}set insertResults(a){a?this.setAttribute(g,""):this.removeAttribute(g)}get baseLinkId(){return this._baseLinkId}set baseLinkId(a){this.setAttribute(h,a)}static get observedAttributes(){return super.observedAttributes.concat(["debounce-duration",e,f,g,h])}attributeChangedCallback(b,c,d){"debounce-duration"===b?(this._debounceDuration=parseFloat(d),this.debounceDurationHandler()):b===e||b===f||b===g?this["_"+a(b)]=null!==d:b===h?this._baseLinkId=d:void 0;super.attributeChangedCallback(b,c,d)}debounce(a,b,c){let d;return function(){const e=this,f=arguments;clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b),c&&!d&&a.apply(e,f)}}debounceDurationHandler(){this.__loadNewUrlDebouncer=this.debounce(()=>{this.loadNewUrl()},this._debounceDuration)}do(){if(this.errorResponse=null,this._cacheResults){const a=this.cachedResults[this._href];if(a)return void(this.result=a)}this.fetchInProgress=!0;let a=this.href;if(this._baseLinkId){const b=self[this._baseLinkId];b&&(a=b.href+a)}self.fetch(this.href,this._reqInit).then(a=>{this.fetchInProgress=!1,a[this._as]().then(b=>{if(200!==a.status)this.errorResponse=a,a.text().then(a=>{this.errorText=a});else{this.result=b,this.cachedResults&&(this.cachedResults[this._href]=b),"string"===typeof b&&this._insertResults&&(this.innerHTML=b);const a={href:this.href};this.dispatchEvent(new CustomEvent("fetch-complete",{detail:a,bubbles:!0,composed:!1}))}})})}connectedCallback(){super.connectedCallback(),this._upgradeProperties(["debounceDuration","reqInitRequired","cacheResults","reqInit"])}}customElements.get(i.is)||customElements.define(i.is,i);const j="set-path";class k extends i{static get is(){return"xtal-fetch-entities"}get forEach(){return this._forEach||this.getAttribute("for-each")}set forEach(a){this.setAttribute("for-each",a)}get setPath(){return this._setPath||this.getAttribute(j)}set setPath(a){this.setAttribute(j,a)}get inEntities(){return this._inEntities}set inEntities(a){this._inEntities=a,this.onPropsChange()}static get observedAttributes(){return super.observedAttributes.concat(["for-each",j])}attributeChangedCallback(b,c,d){b===j||"for-each"===b?this["_"+a(b)]=d:void 0;super.attributeChangedCallback(b,c,d)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(["forEach","setPath","inEntities"])}onPropsChange(){const a=this.setPath||this.forEach||this.inEntities;a&&(this._hasAllThreeProps=this._setPath&&this._forEach&&this.inEntities,!this._hasAllThreeProps)||super.onPropsChange()}do(){if(!this._hasAllThreeProps)return void super.do();const a=this._forEach.split(",");let b=this._inEntities.length;this.fetchInProgress=!0;let c=0;const d=this._baseLinkId?self[this._baseLinkId].href:"";for(let e=0,f=this._inEntities.length;e<f;e++){const f=this._inEntities[e];f.__xtal_idx=c,c++;let g=this._href;if(a.forEach(a=>{g=g.replace(":"+a,f[a])}),g=d+g,this._cacheResults){const a=this.cachedResults[g];if(a)return f[this._setPath]=a,b--,void(0===b&&(this.fetchInProgress=!1))}self.fetch(g,this._reqInit).then(a=>{200===a.status?a[this._as]().then(a=>{b--,0===b&&(this.fetchInProgress=!1),this._cacheResults&&(this.cachedResults[g]=a),f[this._setPath]=a;const c={entity:f,href:g};this.dispatchEvent(new CustomEvent("fetch-complete",{detail:c,bubbles:!0,composed:!1}))}):(a.text().then(a=>{this.errorText=a}),this.errorResponse=a)})}}}customElements.get(k.is)||customElements.define(k.is,k);class l extends k{static get is(){return"xtal-fetch"}}customElements.get(l.is)||customElements.define(l.is,l)})();
(function(){function a(a){return a.replace(/(\-\w)/g,function(a){return a[1].toUpperCase()})}const b='fetch',c='href',d='disabled';class e extends HTMLElement{constructor(){super(...arguments),this._reqInit={credentials:'include'},this._as='json'}static get is(){return'xtal-fetch-get'}de(a,b){const c=new CustomEvent(a+'-changed',{detail:b,bubbles:!0,composed:!1});return this.dispatchEvent(c),c}get fetch(){return this._fetch}set fetch(a){a?this.setAttribute(b,''):this.removeAttribute(b)}get disabled(){return this._disabled}set disabled(a){a?this.setAttribute(d,''):this.removeAttribute(d)}get href(){return this._href}set href(a){this.setAttribute(c,a)}get result(){return this._result}set result(a){this._result=a,this.de('result',a)}static get observedAttributes(){return[b,c,d]}_upgradeProperties(a){a.forEach((a)=>{if(this.hasOwnProperty(a)){let b=this[a];delete this[a],this[a]=b}})}attributeChangedCallback(a,c,e){this['_'+a]=a===b||a===d?null!==e:e;this.onPropsChange()}onPropsChange(){this.loadNewUrl()}loadNewUrl(){this.fetch&&this.href&&!this.disabled&&this.do()}do(){self.fetch(this.href,this._reqInit).then((a)=>{a[this._as]().then((a)=>{this.result=a})})}connectedCallback(){this._upgradeProperties([b,c,d])}}customElements.get(e.is)||customElements.define(e.is,e);const f='debounce-duration',g='req-init-required',h='cache-results',i='insert-results',j='base-link-id';class k extends e{constructor(){super(),this._cacheResults=!1,this._cachedResults={},this._fetchInProgress=!1,this._reqInit=null}get reqInit(){return this._reqInit}set reqInit(a){this._reqInit=a,this.onPropsChange()}onPropsChange(){this.reqInitRequired&&!this.reqInit||(!this.__loadNewUrlDebouncer&&this.debounceDurationHandler(),this.__loadNewUrlDebouncer())}static get is(){return'xtal-fetch-req'}get cacheResults(){return this._cacheResults}set cacheResults(a){a?this.setAttribute(h,''):this.removeAttribute(h)}get cachedResults(){return this._cachedResults}get reqInitRequired(){return this._reqInitRequired||this.hasAttribute(g)}set reqInitRequired(a){a?this.setAttribute(g,''):this.removeAttribute(g)}get debounceDuration(){return this._debounceDuration}set debounceDuration(a){this.setAttribute(f,a.toString())}get errorResponse(){return this._errorResponse}set errorResponse(a){this._errorResponse=a,this.de('error-response',{value:a})}get errorText(){return this._errorText}set errorText(a){this._errorText=a,this.de('error-text',{value:a})}get fetchInProgress(){return this._fetchInProgress}set fetchInProgress(a){this._fetchInProgress=a,this.de('fetch-in-progress',{value:a})}get insertResults(){return this._insertResults}set insertResults(a){a?this.setAttribute(i,''):this.removeAttribute(i)}get baseLinkId(){return this._baseLinkId}set baseLinkId(a){this.setAttribute(j,a)}static get observedAttributes(){return super.observedAttributes.concat([f,g,h,i,j])}attributeChangedCallback(b,c,d){b===f?(this._debounceDuration=parseFloat(d),this.debounceDurationHandler()):b===g||b===h||b===i?this['_'+a(b)]=null!==d:b===j?this._baseLinkId=d:void 0;super.attributeChangedCallback(b,c,d)}debounce(a,b,c){let d;return function(){const e=this,f=arguments;clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b),c&&!d&&a.apply(e,f)}}debounceDurationHandler(){this.__loadNewUrlDebouncer=this.debounce(()=>{this.loadNewUrl()},this._debounceDuration)}do(){if(this.errorResponse=null,this._cacheResults){const a=this.cachedResults[this._href];if(a)return void(this.result=a)}this.fetchInProgress=!0;let a=this.href;if(this._baseLinkId){const b=self[this._baseLinkId];b&&(a=b.href+a)}self.fetch(this.href,this._reqInit).then((a)=>{this.fetchInProgress=!1,a[this._as]().then((b)=>{if(200!==a.status)this.errorResponse=a,a.text().then((a)=>{this.errorText=a});else{this.result=b,this.cachedResults&&(this.cachedResults[this._href]=b),'string'===typeof b&&this._insertResults&&(this.innerHTML=b,this.dispatchEvent(new CustomEvent('dom-change',{bubbles:!0,composed:!0})));const a={href:this.href};this.dispatchEvent(new CustomEvent('fetch-complete',{detail:a,bubbles:!0,composed:!1}))}})})}connectedCallback(){super.connectedCallback(),this._upgradeProperties(['debounceDuration','reqInitRequired','cacheResults','reqInit'])}}customElements.get(k.is)||customElements.define(k.is,k);const l='for-each',m='set-path';class n extends k{static get is(){return'xtal-fetch-entities'}get forEach(){return this._forEach||this.getAttribute(l)}set forEach(a){this.setAttribute(l,a)}get setPath(){return this._setPath||this.getAttribute(m)}set setPath(a){this.setAttribute(m,a)}get inEntities(){return this._inEntities}set inEntities(a){this._inEntities=a,this.onPropsChange()}static get observedAttributes(){return super.observedAttributes.concat([l,m])}attributeChangedCallback(b,c,d){b===m||b===l?this['_'+a(b)]=d:void 0;super.attributeChangedCallback(b,c,d)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(['forEach','setPath','inEntities'])}onPropsChange(){const a=this.setPath||this.forEach||this.inEntities;a&&(this._hasAllThreeProps=this._setPath&&this._forEach&&this.inEntities,!this._hasAllThreeProps)||super.onPropsChange()}do(){if(!this._hasAllThreeProps)return void super.do();const a=this._forEach.split(',');let b=this._inEntities.length;this.fetchInProgress=!0;let c=0;const d=this._baseLinkId?self[this._baseLinkId].href:'';for(let e=0,f=this._inEntities.length;e<f;e++){const f=this._inEntities[e];f.__xtal_idx=c,c++;let g=this._href;if(a.forEach((a)=>{g=g.replace(':'+a,f[a])}),g=d+g,this._cacheResults){const a=this.cachedResults[g];if(a)return f[this._setPath]=a,b--,void(0===b&&(this.fetchInProgress=!1))}self.fetch(g,this._reqInit).then((a)=>{200===a.status?a[this._as]().then((a)=>{b--,0===b&&(this.fetchInProgress=!1),this._cacheResults&&(this.cachedResults[g]=a),f[this._setPath]=a;const c={entity:f,href:g};this.dispatchEvent(new CustomEvent('fetch-complete',{detail:c,bubbles:!0,composed:!1}))}):(a.text().then((a)=>{this.errorText=a}),this.errorResponse=a)})}}}customElements.get(n.is)||customElements.define(n.is,n);class o extends n{static get is(){return'xtal-fetch'}}customElements.get(o.is)||customElements.define(o.is,o)})();
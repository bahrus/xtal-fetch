(function(){var a='xtal-fetch';if(!customElements.get(a)){var b={as:'as',baseLinkId:{cc:'baseLinkId',sc:'base-link-id'},cacheResults:{cc:'cacheResults',sc:'cache-results'},debounceDuration:{cc:'debounceDuration',sc:'debounce-duration'},fetch:'fetch',forEach:{cc:'forEach',sc:'for-each'},href:'href',inEntities:{cc:'inEntities',sc:'in-entities'},insertResults:{cc:'insertResults',sc:'insert-results'},reqInit:{cc:'reqInit',sc:'req-init'},reqInitRequired:{cc:'reqInitRequired',sc:'req-init-required'},setPath:{cc:'setPath',sc:'set-path'}},c={};for(var d in b){var e=b[d];e.sc?c[e.sc]='_'+e.cc:c[e]='_'+d}var f={errorResponse:{cc:'errorRespone',sc:'error-response'},errorText:{cc:'errorText',sc:'error-text'},fetchInProgress:{cc:'fetchInProgress',sc:'fetch-in-progress'},result:'result'},g=function(d){function e(){babelHelpers.classCallCheck(this,e);var a=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return a._as='text',a._cacheResults=!1,a._fetchInProgress=!1,a._cachedResults={},a.__loadNewUrlDebouncer=a.debounce(function(){a.loadNewUrl()},0),a}return babelHelpers.inherits(e,d),babelHelpers.createClass(e,[{key:'de',value:function(a,b){var c=new CustomEvent(a+'-changed',{detail:b,bubbles:!0,composed:!1});return this.dispatchEvent(c),c}},{key:'_upgradeProperty',value:function(a){if(this.hasOwnProperty(a)){var b=this[a];delete this[a],this[a]=b}}},{key:'connectedCallback',value:function(){for(var a in b)this._upgradeProperty(a)}},{key:'attributeChangedCallback',value:function(a,d,e){var f=c[a];a===b.as||a===b.baseLinkId.sc||a===b.forEach.sc||a===b.href||a===b.setPath.sc?this[f]=e:a===b.cacheResults.sc||a===b.fetch||a===b.insertResults.sc||a===b.reqInitRequired.sc?this[f]=null!==e:a===b.debounceDuration.sc?(this[f]=parseInt(e),this.debounceDurationHandler()):a===b.reqInit.sc?this[f]=JSON.parse(e):void 0,this.__loadNewUrlDebouncer()}},{key:'debounce',value:function(a,b,c){var d;return function(){var e=this,f=arguments;clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b),c&&!d&&a.apply(e,f)}}},{key:'debounceDurationHandler',value:function(){var a=this;this.__loadNewUrlDebouncer=this.debounce(function(){a.loadNewUrl()},this._debounceDuration)}},{key:'loadNewUrl',value:function(){var a=this;if(this._fetch&&(!this._reqInitRequired||this._reqInit)&&this._href){this[f.errorText.cc]=null,this[f.errorResponse.cc]=null;var b=this._baseLinkId?self[this._baseLinkId].href:'',c=this,d=0;if(this._forEach){if(!this._inEntities)return;var e=this._forEach.split(','),g=this._inEntities.length;this[f.fetchInProgress.cc]=!0,this._inEntities.forEach(function(h){h.__xtal_idx=d,d++;var i=b+a._href;if(e.forEach(function(a){i=i.replace(':'+a,h[a])}),a._cacheResults){var j=a.cachedResults[i];if(j)return h[a._setPath]=j,g--,void(0===g&&(a[f.fetchInProgress.cc]=!1))}fetch(i,a._reqInit).then(function(b){200===b.status?b[c._as]().then(function(b){g--,0===g&&(a[f.fetchInProgress.cc]=!1),a._cacheResults&&(a.cachedResults[i]=b),h[a._setPath]=b;var c={entity:h,href:i};a.dispatchEvent(new CustomEvent('fetch-complete',{detail:c,bubbles:!0,composed:!1}))}):b.text().then(function(b){a[f.errorText.cc]=b})})})}else{if(this._cacheResults){var h=this.cachedResults[this._href];if(h)return void(c[f.result]=h)}this[f.fetchInProgress.cc]=!0;var i=b+this._href;fetch(i,this._reqInit).then(function(b){a[f.fetchInProgress.cc]=!1,200===b.status?b[c._as]().then(function(b){a.cachedResults&&(a.cachedResults[a._href]=b),c[f.result]=b,'string'===typeof b&&a._insertResults&&(a.innerHTML=b,a.dispatchEvent(new CustomEvent('dom-change',{bubbles:!0,composed:!0})));a.dispatchEvent(new CustomEvent('fetch-complete',{detail:{href:i},bubbles:!0,composed:!1}))}):(a[f.errorResponse.cc]=b,b.text().then(function(b){a[f.errorText.cc]=b}))}).catch(function(b){a[f.errorResponse.cc]=b,a[f.fetchInProgress.cc]=!1})}}}},{key:b.reqInit.cc,get:function(){return this._reqInit},set:function(a){this._reqInit=a,this.__loadNewUrlDebouncer()}},{key:b.reqInitRequired.cc,get:function(){return this._reqInitRequired},set:function(a){a?this.setAttribute(b.reqInitRequired.sc,''):this.removeAttribute(b.reqInitRequired.sc)}},{key:b.href,get:function(){return this._href},set:function(a){this.setAttribute(b.href,a)}},{key:b.inEntities.cc,get:function(){return this._inEntities},set:function(a){this._inEntities=a,this.__loadNewUrlDebouncer()}},{key:f.result,get:function(){return this._result},set:function(a){this._result=a,this.de(f.result,{value:a})}},{key:b.forEach.cc,get:function(){return this._forEach},set:function(a){this.setAttribute(b.forEach.sc,a)}},{key:b.fetch,get:function(){return this._fetch},set:function(a){a?this.setAttribute(b.fetch,''):this.removeAttribute(b.fetch)}},{key:b.setPath.cc,get:function(){return this._setPath},set:function(a){this.setAttribute(b.setPath.sc,a)}},{key:b.as,get:function(){return this._as},set:function(a){this.setAttribute(b.as,a)}},{key:b.cacheResults.cc,get:function(){return this._cachedResults},set:function(a){a?this.setAttribute(b.cacheResults.sc,''):this.removeAttribute(b.cacheResults.sc)}},{key:f.errorText.cc,get:function(){return this._errorText},set:function(a){this._errorText=a,this.de(f.errorText.sc,{value:a})}},{key:f.errorResponse.cc,get:function(){return this._errorResponse},set:function(a){this._errorResponse=a,this.de(f.errorResponse.sc,{value:a})}},{key:f.fetchInProgress.cc,get:function(){return this._fetchInProgress},set:function(a){this._fetchInProgress=a,this.de(f.fetchInProgress.sc,{value:a})}},{key:b.baseLinkId.cc,get:function(){return this._baseLinkId},set:function(a){this.setAttribute(b.baseLinkId.sc,a)}},{key:b.debounceDuration.cc,get:function(){return this._debounceDuration},set:function(a){this.setAttribute(b.debounceDuration.sc,a.toString())}},{key:b.insertResults.cc,get:function(){return this._insertResults},set:function(a){a?this.setAttribute(b.insertResults.sc,''):this.removeAttribute(b.insertResults.sc)}},{key:'cachedResults',get:function(){return this._cachedResults}}],[{key:'is',get:function(){return a}},{key:'observedAttributes',get:function(){var a=[];for(var b in c)a.push(b);return a}}]),e}(HTMLElement);customElements.define(g.is,g)}})();
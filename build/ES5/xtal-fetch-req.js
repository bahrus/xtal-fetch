import{XtalFetchGet}from"./xtal-fetch-get.js";export function snakeToCamel(s){return s.replace(/(\-\w)/g,function(m){return m[1].toUpperCase()})}var debounceDuration="debounce-duration",reqInitRequired="req-init-required",cacheResults="cache-results",insertResults="insert-results",baseLinkId="base-link-id";export var XtalFetchReq=function(_XtalFetchGet){babelHelpers.inherits(XtalFetchReq,_XtalFetchGet);function XtalFetchReq(){var _this;babelHelpers.classCallCheck(this,XtalFetchReq);_this=babelHelpers.possibleConstructorReturn(this,(XtalFetchReq.__proto__||Object.getPrototypeOf(XtalFetchReq)).call(this));_this._cacheResults=!1;_this._cachedResults={};_this._fetchInProgress=!1;_this._reqInit=null;return _this}babelHelpers.createClass(XtalFetchReq,[{key:"onPropsChange",value:function onPropsChange(){if(this.reqInitRequired&&!this.reqInit)return;if(!this.__loadNewUrlDebouncer){this.debounceDurationHandler()}this.__loadNewUrlDebouncer()}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){switch(name){case debounceDuration:this._debounceDuration=parseFloat(newValue);this.debounceDurationHandler();break;case reqInitRequired:case cacheResults:case insertResults:this["_"+snakeToCamel(name)]=null!==newValue;break;case baseLinkId:this._baseLinkId=newValue;break;}babelHelpers.get(XtalFetchReq.prototype.__proto__||Object.getPrototypeOf(XtalFetchReq.prototype),"attributeChangedCallback",this).call(this,name,oldValue,newValue)}},{key:"debounce",value:function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;clearTimeout(timeout);timeout=setTimeout(function(){timeout=null;if(!immediate)func.apply(context,args)},wait);if(immediate&&!timeout)func.apply(context,args)}}},{key:"debounceDurationHandler",value:function debounceDurationHandler(){var _this2=this;this.__loadNewUrlDebouncer=this.debounce(function(){_this2.loadNewUrl()},this._debounceDuration)}},{key:"do",value:function _do(){var _this3=this;this.errorResponse=null;if(this._cacheResults){var val=this.cachedResults[this._href];if(val){this.result=val;return}}this.fetchInProgress=!0;var href=this.href;if(this._baseLinkId){var link=self[this._baseLinkId];if(link)href=link.href+href}self.fetch(this.href,this._reqInit).then(function(resp){_this3.fetchInProgress=!1;resp[_this3._as]().then(function(result){if(200!==resp.status){_this3.errorResponse=resp;resp.text().then(function(val){_this3.errorText=val})}else{_this3.result=result;if(_this3.cachedResults){_this3.cachedResults[_this3._href]=result}if("string"===typeof result&&_this3._insertResults){_this3.innerHTML=result}var detail={href:_this3.href,result:result};_this3.dispatchEvent(new CustomEvent("fetch-complete",{detail:detail,bubbles:!0,composed:!1}))}})})}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(XtalFetchReq.prototype.__proto__||Object.getPrototypeOf(XtalFetchReq.prototype),"connectedCallback",this).call(this);this._upgradeProperties(["debounceDuration","reqInitRequired","cacheResults","reqInit"])}},{key:"reqInit",get:function get(){return this._reqInit},set:function set(val){this._reqInit=val;this.onPropsChange()}},{key:"cacheResults",get:function get(){return this._cacheResults},set:function set(val){if(val){this.setAttribute(cacheResults,"")}else{this.removeAttribute(cacheResults)}}},{key:"cachedResults",get:function get(){return this._cachedResults}},{key:"reqInitRequired",get:function get(){return this.hasAttribute(reqInitRequired)},set:function set(val){if(val){this.setAttribute(reqInitRequired,"")}else{this.removeAttribute(reqInitRequired)}}},{key:"debounceDuration",get:function get(){return this._debounceDuration},set:function set(val){this.setAttribute(debounceDuration,val.toString())}},{key:"errorResponse",get:function get(){return this._errorResponse},set:function set(val){this._errorResponse=val;this.de("error-response",{value:val})}},{key:"errorText",get:function get(){return this._errorText},set:function set(val){this._errorText=val;this.de("error-text",{value:val})}},{key:"fetchInProgress",get:function get(){return this._fetchInProgress},set:function set(val){this._fetchInProgress=val;this.de("fetch-in-progress",{value:val})}},{key:"insertResults",get:function get(){return this._insertResults},set:function set(val){if(val){this.setAttribute(insertResults,"")}else{this.removeAttribute(insertResults)}}},{key:"baseLinkId",get:function get(){return this._baseLinkId},set:function set(val){this.setAttribute(baseLinkId,val)}}],[{key:"is",get:function get(){return"xtal-fetch-req"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(XtalFetchReq.__proto__||Object.getPrototypeOf(XtalFetchReq),"observedAttributes",this).concat([debounceDuration,reqInitRequired,cacheResults,insertResults,baseLinkId])}}]);return XtalFetchReq}(XtalFetchGet);if(!customElements.get(XtalFetchReq.is)){customElements.define(XtalFetchReq.is,XtalFetchReq)}
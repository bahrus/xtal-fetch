import{XtalFetchReq,snakeToCamel}from"./xtal-fetch-req.js";var forEach="for-each",setPath="set-path";export var XtalFetchEntities=function(_XtalFetchReq){babelHelpers.inherits(XtalFetchEntities,_XtalFetchReq);function XtalFetchEntities(){babelHelpers.classCallCheck(this,XtalFetchEntities);return babelHelpers.possibleConstructorReturn(this,(XtalFetchEntities.__proto__||Object.getPrototypeOf(XtalFetchEntities)).apply(this,arguments))}babelHelpers.createClass(XtalFetchEntities,[{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){switch(name){case setPath:case forEach:this["_"+snakeToCamel(name)]=newValue;}babelHelpers.get(XtalFetchEntities.prototype.__proto__||Object.getPrototypeOf(XtalFetchEntities.prototype),"attributeChangedCallback",this).call(this,name,oldValue,newValue)}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(XtalFetchEntities.prototype.__proto__||Object.getPrototypeOf(XtalFetchEntities.prototype),"connectedCallback",this).call(this);this._upgradeProperties(["forEach","setPath","inEntities"])}},{key:"onPropsChange",value:function onPropsChange(){var hasAtLeastOneProp=this.setPath||this.forEach||this.inEntities;if(hasAtLeastOneProp){this._hasAllThreeProps=this._setPath&&this._forEach&&this.inEntities;if(!this._hasAllThreeProps){return}}babelHelpers.get(XtalFetchEntities.prototype.__proto__||Object.getPrototypeOf(XtalFetchEntities.prototype),"onPropsChange",this).call(this)}},{key:"do",value:function _do(){var _this=this;if(!this._hasAllThreeProps){babelHelpers.get(XtalFetchEntities.prototype.__proto__||Object.getPrototypeOf(XtalFetchEntities.prototype),"do",this).call(this);return}var keys=this._forEach.split(","),remainingCalls=this._inEntities.length;this.fetchInProgress=!0;for(var counter=0,base=this._baseLinkId?self[this._baseLinkId].href:"",_loop=function(i){var entity=_this._inEntities[i];entity.__xtal_idx=counter;counter++;var href=_this._href;keys.forEach(function(key){href=href.replace(":"+key,entity[key])});href=base+href;if(_this._cacheResults){var val=_this.cachedResults[href];if(val){entity[_this._setPath]=val;remainingCalls--;if(0===remainingCalls)_this.fetchInProgress=!1;return{v:void 0}}}self.fetch(href,_this._reqInit).then(function(resp){if(200!==resp.status){resp.text().then(function(val){_this.errorText=val});_this.errorResponse=resp}else{resp[_this._as]().then(function(val){remainingCalls--;if(0===remainingCalls){_this.fetchInProgress=!1;_this.result=_this.inEntities.slice(0)}if(_this._cacheResults)_this.cachedResults[href]=val;entity[_this._setPath]=val;var detail={entity:entity,href:href};_this.dispatchEvent(new CustomEvent("fetch-complete",{detail:detail,bubbles:!0,composed:!1}))})}})},i=0,ii=this._inEntities.length,_ret;i<ii;i++){_ret=_loop(i,ii);if("object"===babelHelpers.typeof(_ret))return _ret.v}}},{key:"forEach",get:function get(){return this._forEach||this.getAttribute(forEach)},set:function set(val){this.attr(forEach,val)}},{key:"setPath",get:function get(){return this._setPath||this.getAttribute(setPath)},set:function set(val){this.attr(setPath,val)}},{key:"inEntities",get:function get(){return this._inEntities},set:function set(val){this._inEntities=val;this.onPropsChange()}}],[{key:"is",get:function get(){return"xtal-fetch-entities"}},{key:"observedAttributes",get:function get(){return babelHelpers.get(XtalFetchEntities.__proto__||Object.getPrototypeOf(XtalFetchEntities),"observedAttributes",this).concat([forEach,setPath])}}]);return XtalFetchEntities}(XtalFetchReq);if(!customElements.get(XtalFetchEntities.is)){customElements.define(XtalFetchEntities.is,XtalFetchEntities)}var XtalFetch=function(_XtalFetchEntities){babelHelpers.inherits(XtalFetch,_XtalFetchEntities);function XtalFetch(){babelHelpers.classCallCheck(this,XtalFetch);return babelHelpers.possibleConstructorReturn(this,(XtalFetch.__proto__||Object.getPrototypeOf(XtalFetch)).apply(this,arguments))}babelHelpers.createClass(XtalFetch,null,[{key:"is",get:function get(){return"xtal-fetch"}}]);return XtalFetch}(XtalFetchEntities);if(!customElements.get(XtalFetch.is)){customElements.define(XtalFetch.is,XtalFetch)}
!function(){function t(t){let e=t.is;customElements.get(e)?console.warn("Already registered "+e):customElements.define(e,t)}const e="disabled";const s="base-link-id";const r="fetch",i="href",h="as";class n extends(function(t){return class extends t{constructor(){super(...arguments),this._evCount={}}static get observedAttributes(){return[e]}get disabled(){return this._disabled}set disabled(t){this.attr(e,t,"")}attr(t,e,s){this[(e?"set":"remove")+"Attribute"](t,s||e)}to$(t){const e=t%2;return(t-e)/2+"-"+e}incAttr(t){const e=this._evCount;t in e?e[t]++:e[t]=0,this.attr("data-"+t,this.to$(e[t]))}attributeChangedCallback(t,s,r){switch(t){case e:this._disabled=null!==r}}de(t,e,s=!1){const r=t+(s?"":"-changed"),i=new CustomEvent(r,{detail:e,bubbles:!0,composed:!1});return this.dispatchEvent(i),this.incAttr(r),i}_upgradeProperties(t){t.forEach(t=>{if(this.hasOwnProperty(t)){let e=this[t];delete this[t],this[t]=e}})}}}(HTMLElement)){constructor(){super(...arguments),this._reqInit={credentials:"same-origin"},this._as="json"}static get is(){return"xtal-fetch-get"}get fetch(){return this._fetch}set fetch(t){this.attr(r,!!t,"")}get as(){return this._as}set as(t){this.attr(h,t)}get href(){return this._href}set href(t){this.attr(i,t)}get result(){return this._result}set result(t){this._result=t,this.value=t,this.de("result",{value:t})}static get observedAttributes(){return super.observedAttributes.concat([r,i,h])}attributeChangedCallback(t,e,s){switch(t){case r:const e=this["_"+t];if(this._fetch=null!==s,e===this._fetch)return;break;default:this["_"+t]=s}super.attributeChangedCallback(t,e,s),this.onPropsChange()}onPropsChange(){this.loadNewUrl()}loadNewUrl(){this.fetch&&this.href&&!this.disabled&&this._connected&&this.do()}do(){self.fetch(this.href,this._reqInit).then(t=>{t[this._as]().then(t=>{this.result=t})})}connectedCallback(){this._initDisp=this.style.display,this.style.display="none",this._upgradeProperties([r,i]),this._connected=!0,this.onPropsChange()}}function a(t){return t.replace(/(\-\w)/g,function(t){return t[1].toUpperCase()})}t(n);const o="debounce-duration",c="req-init-required",l="cache-results",u="insert-results",d="req-init";class _ extends(function(t){return class extends t{get baseLinkId(){return this._baseLinkId}set baseLinkId(t){this.setAttribute(s,t)}getFullURL(t){let e=t;if(this._baseLinkId){const t=self[this._baseLinkId];t&&(e=t.href+e)}return e}}}(n)){constructor(){super(),this._cacheResults=!1,this._cachedResults={},this._fetchInProgress=!1,this._reqInit=null}get reqInit(){return this._reqInit}set reqInit(t){this._reqInit=t,this.onPropsChange()}onPropsChange(){this.reqInitRequired&&!this.reqInit||(this.__loadNewUrlDebouncer||this.debounceDurationHandler(),this.__loadNewUrlDebouncer())}static get is(){return"xtal-fetch-req"}get cacheResults(){return this._cacheResults}set cacheResults(t){this.attr(l,t,"")}get cachedResults(){return this._cachedResults}get reqInitRequired(){return this.hasAttribute(c)}set reqInitRequired(t){this.attr(c,t,"")}get debounceDuration(){return this._debounceDuration}set debounceDuration(t){this.setAttribute(o,t.toString())}get errorResponse(){return this._errorResponse}set errorResponse(t){(this._errorResponse||t)&&(this._errorResponse=t,null!==t&&this.de("error-response",{value:t}))}get errorText(){return this._errorText}set errorText(t){(t||this._errorText)&&(this._errorText=t,this.attr("errorText",t),this.de("error-text",{value:t}))}get fetchInProgress(){return this._fetchInProgress}set fetchInProgress(t){this._fetchInProgress=t,this.de("fetch-in-progress",{value:t})}get insertResults(){return this._insertResults}set insertResults(t){this.attr(u,t,"")}set abort(t){this._controller&&this._controller.abort()}static get observedAttributes(){return super.observedAttributes.concat([o,c,l,u,s,d])}attributeChangedCallback(t,e,r){switch(t){case o:this._debounceDuration=parseFloat(r),this.debounceDurationHandler();break;case c:case l:case u:this["_"+a(t)]=null!==r;break;case s:this._baseLinkId=r;break;case d:this._reqInit=JSON.parse(r)}super.attributeChangedCallback(t,e,r)}debounce(t,e,s){let r;return function(){const i=this,h=arguments;clearTimeout(r),r=setTimeout(function(){r=null,s||t.apply(i,h)},e),s&&!r&&t.apply(i,h)}}debounceDurationHandler(){this.__loadNewUrlDebouncer=this.debounce(()=>{this.loadNewUrl()},this._debounceDuration)}do(){if(this.errorResponse=null,this._cacheResults){const t=this.cachedResults[this._href];if(t)return void(this.result=t);if(this._fetchInProgress)return void setTimeout(()=>{this.do()},100)}this.fetchInProgress&&(this.abort=!0),this.fetchInProgress=!0;let t=this.href;if(t=this.getFullURL(t),"undefined"!=typeof AbortController){this._controller=new AbortController;const t=this._controller.signal;this._reqInit?this._reqInit.signal=t:this._reqInit={signal:t}}self.fetch(t,this._reqInit).then(t=>{this.fetchInProgress=!1,t[this._as]().then(e=>{if(200!==t.status){this.errorResponse=t;const e=t.text;e&&e().then(t=>{this.errorText=t})}else{this.result=e,this.cachedResults&&(this.cachedResults[this._href]=e),"string"==typeof e&&this._insertResults&&(this.style.display=this._initDisp,this.innerHTML=e);const t={href:this.href,result:e};this.de("fetch-complete",t,!0)}})}).catch(t=>{"AbortError"===t.name&&(console.log("Fetch aborted"),this.fetchInProgress=!1)})}connectedCallback(){this._upgradeProperties(["debounceDuration","reqInitRequired","cacheResults","reqInit"]),super.connectedCallback()}}t(_);const b="for-each",f="set-path";class g extends _{static get is(){return"xtal-fetch-entities"}get forEach(){return this._forEach||this.getAttribute(b)}set forEach(t){this.attr(b,t)}get setPath(){return this._setPath||this.getAttribute(f)}set setPath(t){this.attr(f,t)}get inEntities(){return this._inEntities}set inEntities(t){this._inEntities=t,this.onPropsChange()}static get observedAttributes(){return super.observedAttributes.concat([b,f])}attributeChangedCallback(t,e,s){switch(t){case f:case b:this["_"+a(t)]=s}super.attributeChangedCallback(t,e,s)}connectedCallback(){super.connectedCallback(),this._upgradeProperties(["forEach","setPath","inEntities"])}onPropsChange(){(this.setPath||this.forEach||this.inEntities)&&(this._hasAllThreeProps=this._setPath&&this._forEach&&this.inEntities,!this._hasAllThreeProps)||super.onPropsChange()}do(){if(!this._hasAllThreeProps)return void super.do();const t=this._forEach.split(",");let e=this._inEntities.length;this.fetchInProgress=!0;let s=0;const r=this._baseLinkId?self[this._baseLinkId].href:"";for(let i=0,h=this._inEntities.length;i<h;i++){const h=this._inEntities[i];h.__xtal_idx=s,s++;let n=this._href;if(t.forEach(t=>{n=n.replace(":"+t,h[t])}),n=r+n,this._cacheResults){const t=this.cachedResults[n];if(t)return h[this._setPath]=t,void(0===--e&&(this.fetchInProgress=!1))}self.fetch(n,this._reqInit).then(t=>{200!==t.status?(t.text().then(t=>{this.errorText=t}),this.errorResponse=t):t[this._as]().then(t=>{0===--e&&(this.fetchInProgress=!1,this.result=this.inEntities.slice(0)),this._cacheResults&&(this.cachedResults[n]=t),h[this._setPath]=t;const s={entity:h,href:n};this.dispatchEvent(new CustomEvent("fetch-complete",{detail:s,bubbles:!0,composed:!1}))})})}}}t(g);t(class extends g{static get is(){return"xtal-fetch"}})}();